
<!-- @base.html: layout general del módulo de tareas.
     Incluye Tailwind para estilos y HTMX para actualizaciones parciales.
     Define bloques comunes (title, content) y JS mínimo para CSRF y animaciones. -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Sistema de gestión de tareas - Besimplit Challenge" />
    <title>{% block title %}Gestor de Tareas{% endblock %} | Besimplit</title>

    <!-- Tailwind (Play CDN, para prototipo) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>

    <!-- Estilos personalizados -->
    <style>
        /* Animaciones para transiciones de HTMX */
        .htmx-swapping {
            opacity: 0;
            transition: opacity 300ms ease-out;
        }

        .htmx-settling {
            opacity: 1;
            transition: opacity 300ms ease-in;
        }

        /* Animación de entrada para nuevas tareas */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-enter {
            animation: slideIn 300ms ease-out;
        }

        /*  checkbox */
        input[type="checkbox"]:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
    </style>
</head>

<!-- configuración JS para inyectar X-CSRFToken -->
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-xl font-semibold text-gray-800">Besimplit Tasks</h1>
                <span class="text-xs text-gray-500">Desafío Técnico</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="mt-12 py-6 text-center text-xs text-gray-400">
        <p>Tecnologías usadas: Django · HTMX · Tailwind</p>
    </footer>

    <!-- CSRF desde cookie -->
    <script>
    // lee cookie (función recomendada por docs Django)
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    // Inserta CSRF en todas las requests HTMX
    document.body.addEventListener('htmx:configRequest', function(event) {
        const csrftoken = getCookie('csrftoken');
        if (csrftoken) {
            event.detail.headers['X-CSRFToken'] = csrftoken;
        }
    });

    // agrega clase de animación a elementos añadidos al task-list
    document.body.addEventListener('htmx:afterSwap', function(event) {
        try {
            const target = event.detail.target;
            // Si el swap afectó al contenedor #task-list o incluyó nuevos hijos
            if (target && (target.id === 'task-list' || target.closest('#task-list'))) {
                // aplica animación a elementos añadidos (si hay varios, aplicamos a los nuevos)
                const items = (target.id === 'task-list') ? target.children : target.querySelectorAll('#task-list > *');
                if (items && items.length > 0) {
                    // Elige el primer hijo nuevo si existe
                    const newItem = target.firstElementChild || items[0];
                    if (newItem) {
                        newItem.classList.add('task-enter');
                        // opcional: limpiar la clase después de animación
                        setTimeout(() => newItem.classList.remove('task-enter'), 800);
                    }
                }
            }
        } catch (e) {
           
            console.warn('htmx afterSwap handler error', e);
        }
    });

    // Mejor confirmar para eliminar (usa el built-in htmx confirm flow)
    document.body.addEventListener('htmx:confirm', function(event) {
        const q = event.detail.question || '';
        if (q.toLowerCase().includes('eliminar') || q.toLowerCase().includes('seguro')) {
            event.preventDefault();
            if (confirm('⚠️' + q)) {
                event.detail.issueRequest();
            }
        }
    });
    </script>
</body>
</html>
